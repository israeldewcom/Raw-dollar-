<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raw Wealthy Admin Dashboard v40.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --gray-light: #e5e7eb;
            --border: #d1d5db;
            --sidebar-width: 250px;
            --header-height: 70px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app-container {
            display: none;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .login-box {
            background: white;
            border-radius: 15px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .login-logo h1 {
            font-size: 1.8rem;
            color: var(--dark);
        }

        .login-logo .version {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .login-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .status-approved {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary);
        }

        .status-active {
            background: rgba(59, 130, 246, 0.1);
            color: var(--info);
        }

        .status-rejected {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .status-completed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary);
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: white;
            border-radius: 8px;
            padding: 16px 20px;
            margin-top: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 400px;
            animation: toastSlideIn 0.3s ease;
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.success {
            border-left: 4px solid var(--secondary);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.warning {
            border-left: 4px solid var(--warning);
        }

        .toast.info {
            border-left: 4px solid var(--info);
        }

        .toast-icon {
            font-size: 1.25rem;
        }

        .toast.success .toast-icon {
            color: var(--secondary);
        }

        .toast.error .toast-icon {
            color: var(--danger);
        }

        .toast.warning .toast-icon {
            color: var(--warning);
        }

        .toast.info .toast-icon {
            color: var(--info);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1.25rem;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <div class="login-logo">
                <i class="fas fa-gem"></i>
                <h1>Raw Wealthy Admin</h1>
                <div class="version">v40.0 - Production Ready</div>
            </div>
            
            <div class="login-error" id="loginError">
                <i class="fas fa-exclamation-circle"></i>
                <span id="errorMessage"></span>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="email" placeholder="admin@rawwealthy.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="••••••••" required>
                </div>
                
                <button type="submit" class="btn btn-primary" id="loginBtn">
                    <span id="loginText">Sign In</span>
                    <span id="loginLoading" class="loading" style="display: none;"></span>
                </button>
            </form>
            
            <div style="margin-top: 20px; text-align: center; color: var(--gray); font-size: 0.9rem;">
                <p>Default credentials: admin@rawwealthy.com / Admin123456</p>
            </div>
        </div>
    </div>

    <!-- Main App Container (hidden until login) -->
    <div class="app-container" id="appContainer">
        <!-- App content will be loaded here -->
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Configuration
        const BACKEND_URL = 'https://real-wealthy-1.onrender.com'
            ? 'http://localhost:10000' 
            : 'https://real-wealthy-1.onrender.com';

        const API_CONFIG = {
            endpoints: {
                login: '/api/auth/login',
                profile: '/api/profile',
                dashboard: '/api/admin/dashboard',
                users: '/api/admin/users',
                userStatus: '/api/admin/users/{id}/status',
                userRole: '/api/admin/users/{id}/role',
                pendingInvestments: '/api/admin/pending-investments',
                approveInvestment: '/api/admin/investments/{id}/approve',
                pendingDeposits: '/api/admin/pending-deposits',
                approveDeposit: '/api/admin/deposits/{id}/approve',
                pendingWithdrawals: '/api/admin/pending-withdrawals',
                approveWithdrawal: '/api/admin/withdrawals/{id}/approve',
                pendingKYC: '/api/admin/pending-kyc',
                approveKYC: '/api/admin/kyc/{id}/approve',
                transactions: '/api/admin/transactions',
                plans: '/api/plans',
                createUser: '/api/auth/register',
                health: '/health'
            }
        };

        // Global State
        const APP_STATE = {
            token: localStorage.getItem('rawWealthyToken'),
            user: null,
            currentPage: 'dashboard',
            isLoading: false,
            dataCache: new Map(),
            lastFetch: new Map()
        };

        // DOM Elements
        const loginContainer = document.getElementById('loginContainer');
        const appContainer = document.getElementById('appContainer');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const errorMessage = document.getElementById('errorMessage');
        const loginBtn = document.getElementById('loginBtn');
        const loginText = document.getElementById('loginText');
        const loginLoading = document.getElementById('loginLoading');
        const toastContainer = document.getElementById('toastContainer');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            if (APP_STATE.token) {
                verifyTokenAndLoadApp();
            } else {
                showLogin();
            }
        });

        // Show login screen
        function showLogin() {
            loginContainer.style.display = 'flex';
            appContainer.style.display = 'none';
        }

        // Show main app
        function showApp() {
            loginContainer.style.display = 'none';
            appContainer.style.display = 'block';
        }

        // Verify token and load app
        async function verifyTokenAndLoadApp() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/profile`, {
                    headers: {
                        'Authorization': `Bearer ${APP_STATE.token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        APP_STATE.user = data.data.user;
                        loadMainApp();
                        showApp();
                    } else {
                        throw new Error('Invalid token');
                    }
                } else {
                    throw new Error('Token verification failed');
                }
            } catch (error) {
                localStorage.removeItem('rawWealthyToken');
                showLogin();
                showToast('Session expired. Please login again.', 'warning');
            }
        }

        // Login form submission
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!email || !password) {
                showError('Please enter both email and password');
                return;
            }
            
            setLoading(true);
            
            try {
                const response = await fetch(`${BACKEND_URL}${API_CONFIG.endpoints.login}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    APP_STATE.token = data.data.token;
                    APP_STATE.user = data.data.user;
                    
                    localStorage.setItem('rawWealthyToken', APP_STATE.token);
                    showToast('Login successful!', 'success');
                    
                    setTimeout(() => {
                        loadMainApp();
                        showApp();
                    }, 1000);
                } else {
                    throw new Error(data.message || 'Login failed');
                }
            } catch (error) {
                showError(error.message);
            } finally {
                setLoading(false);
            }
        });

        // Set loading state
        function setLoading(isLoading) {
            APP_STATE.isLoading = isLoading;
            loginBtn.disabled = isLoading;
            loginText.style.display = isLoading ? 'none' : 'inline';
            loginLoading.style.display = isLoading ? 'inline-block' : 'none';
        }

        // Show error message
        function showError(message) {
            errorMessage.textContent = message;
            loginError.style.display = 'flex';
            setTimeout(() => {
                loginError.style.display = 'none';
            }, 5000);
        }

        // Show toast notification
        function showToast(message, type = 'info', duration = 5000) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="${icons[type] || icons.info}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close">&times;</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto remove
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, duration);
            
            // Close button
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.remove();
            });
        }

        // API Fetch Helper
        async function apiFetch(endpoint, options = {}) {
            const url = endpoint.startsWith('http') ? endpoint : `${BACKEND_URL}${endpoint}`;
            const defaultOptions = {
                headers: {
                    'Authorization': `Bearer ${APP_STATE.token}`,
                    'Content-Type': 'application/json',
                    ...options.headers
                }
            };
            
            const response = await fetch(url, { ...defaultOptions, ...options });
            
            if (response.status === 401) {
                // Token expired
                localStorage.removeItem('rawWealthyToken');
                showLogin();
                showToast('Session expired. Please login again.', 'warning');
                throw new Error('Unauthorized');
            }
            
            if (response.status === 429) {
                showToast('Too many requests. Please wait.', 'warning');
                throw new Error('Rate limited');
            }
            
            return response;
        }

        // Load main app
        function loadMainApp() {
            appContainer.innerHTML = `
                <div class="dashboard-container">
                    <!-- Sidebar -->
                    <aside class="sidebar" id="sidebar">
                        <div class="sidebar-header">
                            <div class="logo">
                                <div class="logo-icon">
                                    <i class="fas fa-gem"></i>
                                </div>
                                <div>
                                    <div class="logo-text">Raw Wealthy</div>
                                    <div class="logo-version">v40.0</div>
                                </div>
                            </div>
                        </div>
                        
                        <nav class="sidebar-nav">
                            <div class="nav-section">
                                <div class="nav-title">Main</div>
                                <ul class="nav-items">
                                    <li class="nav-item">
                                        <a href="#" class="nav-link active" data-page="dashboard">
                                            <span class="nav-icon"><i class="fas fa-home"></i></span>
                                            <span class="nav-text">Dashboard</span>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="#" class="nav-link" data-page="analytics">
                                            <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
                                            <span class="nav-text">Analytics</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            
                            <div class="nav-section">
                                <div class="nav-title">Management</div>
                                <ul class="nav-items">
                                    <li class="nav-item">
                                        <a href="#" class="nav-link" data-page="users">
                                            <span class="nav-icon"><i class="fas fa-users"></i></span>
                                            <span class="nav-text">Users</span>
                                            <span class="nav-badge" id="userCount">0</span>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="#" class="nav-link" data-page="investments">
                                            <span class="nav-icon"><i class="fas fa-chart-pie"></i></span>
                                            <span class="nav-text">Investments</span>
                                            <span class="nav-badge" id="investmentCount">0</span>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="#" class="nav-link" data-page="deposits">
                                            <span class="nav-icon"><i class="fas fa-money-bill-wave"></i></span>
                                            <span class="nav-text">Deposits</span>
                                            <span class="nav-badge" id="depositCount">0</span>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="#" class="nav-link" data-page="withdrawals">
                                            <span class="nav-icon"><i class="fas fa-wallet"></i></span>
                                            <span class="nav-text">Withdrawals</span>
                                            <span class="nav-badge" id="withdrawalCount">0</span>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="#" class="nav-link" data-page="transactions">
                                            <span class="nav-icon"><i class="fas fa-exchange-alt"></i></span>
                                            <span class="nav-text">Transactions</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            
                            <div class="nav-section">
                                <div class="nav-title">Verification</div>
                                <ul class="nav-items">
                                    <li class="nav-item">
                                        <a href="#" class="nav-link" data-page="kyc">
                                            <span class="nav-icon"><i class="fas fa-id-card"></i></span>
                                            <span class="nav-text">KYC</span>
                                            <span class="nav-badge" id="kycCount">0</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            
                            <div class="nav-section">
                                <div class="nav-title">System</div>
                                <ul class="nav-items">
                                    <li class="nav-item">
                                        <a href="#" class="nav-link" data-page="plans">
                                            <span class="nav-icon"><i class="fas fa-cubes"></i></span>
                                            <span class="nav-text">Plans</span>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="#" class="nav-link" data-page="settings">
                                            <span class="nav-icon"><i class="fas fa-cog"></i></span>
                                            <span class="nav-text">Settings</span>
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="#" class="nav-link" id="logoutBtn">
                                            <span class="nav-icon"><i class="fas fa-sign-out-alt"></i></span>
                                            <span class="nav-text">Logout</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </nav>
                    </aside>
                    
                    <!-- Main Content -->
                    <main class="main-content">
                        <!-- Header -->
                        <header class="header">
                            <div class="header-left">
                                <button class="menu-toggle" id="menuToggle">
                                    <i class="fas fa-bars"></i>
                                </button>
                                <h1 class="page-title" id="pageTitle">Dashboard</h1>
                            </div>
                            
                            <div class="header-right">
                                <div class="user-menu" id="userMenu">
                                    <div class="user-avatar">${APP_STATE.user?.full_name?.charAt(0) || 'A'}</div>
                                    <div class="user-info">
                                        <div class="user-name">${APP_STATE.user?.full_name || 'Admin'}</div>
                                        <div class="user-role">${APP_STATE.user?.role?.toUpperCase() || 'ADMIN'}</div>
                                    </div>
                                </div>
                            </div>
                        </header>
                        
                        <!-- Content Area -->
                        <div class="content" id="contentArea">
                            <div id="pageContent">
                                <!-- Content will be loaded here -->
                            </div>
                        </div>
                    </main>
                </div>
                
                <!-- Loading Overlay -->
                <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                    <div class="loading-spinner"></div>
                </div>
            `;

            // Add CSS for the loaded components
            addAppStyles();
            
            // Initialize app
            initializeApp();
        }

        // Add app styles
        function addAppStyles() {
            const styles = `
                /* Layout */
                .dashboard-container {
                    display: flex;
                    min-height: 100vh;
                }
                
                /* Sidebar */
                .sidebar {
                    width: var(--sidebar-width);
                    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
                    color: white;
                    position: fixed;
                    height: 100vh;
                    overflow-y: auto;
                    transition: var(--transition);
                    z-index: 1000;
                    box-shadow: 0 0 20px rgba(0,0,0,0.1);
                }
                
                .sidebar-header {
                    padding: 1.5rem;
                    border-bottom: 1px solid rgba(255,255,255,0.1);
                }
                
                .logo {
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                }
                
                .logo-icon {
                    font-size: 2rem;
                }
                
                .logo-text {
                    font-size: 1.25rem;
                    font-weight: 700;
                }
                
                .logo-version {
                    font-size: 0.75rem;
                    opacity: 0.8;
                    background: rgba(255,255,255,0.2);
                    padding: 0.15rem 0.5rem;
                    border-radius: 1rem;
                    margin-top: 0.25rem;
                }
                
                .sidebar-nav {
                    padding: 1.5rem 0;
                }
                
                .nav-section {
                    margin-bottom: 1.5rem;
                }
                
                .nav-title {
                    font-size: 0.75rem;
                    text-transform: uppercase;
                    letter-spacing: 0.05em;
                    padding: 0 1.5rem;
                    margin-bottom: 0.75rem;
                    opacity: 0.7;
                    font-weight: 600;
                }
                
                .nav-items {
                    list-style: none;
                }
                
                .nav-item {
                    margin-bottom: 0.25rem;
                }
                
                .nav-link {
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    padding: 0.75rem 1.5rem;
                    color: rgba(255,255,255,0.8);
                    text-decoration: none;
                    transition: var(--transition);
                    border-left: 3px solid transparent;
                    cursor: pointer;
                }
                
                .nav-link:hover, .nav-link.active {
                    background: rgba(255,255,255,0.1);
                    color: white;
                    border-left-color: white;
                }
                
                .nav-icon {
                    width: 20px;
                    text-align: center;
                }
                
                .nav-badge {
                    margin-left: auto;
                    background: var(--secondary);
                    color: white;
                    font-size: 0.75rem;
                    padding: 0.15rem 0.5rem;
                    border-radius: 1rem;
                }
                
                /* Main Content */
                .main-content {
                    flex: 1;
                    margin-left: var(--sidebar-width);
                    transition: var(--transition);
                }
                
                /* Header */
                .header {
                    height: var(--header-height);
                    background: white;
                    border-bottom: 1px solid var(--border);
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 0 2rem;
                    position: sticky;
                    top: 0;
                    z-index: 100;
                }
                
                .header-left {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                }
                
                .menu-toggle {
                    background: none;
                    border: none;
                    font-size: 1.25rem;
                    color: var(--gray);
                    cursor: pointer;
                    display: none;
                }
                
                .page-title {
                    font-size: 1.5rem;
                    font-weight: 600;
                    color: var(--dark);
                }
                
                .user-menu {
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    cursor: pointer;
                    padding: 0.5rem;
                    border-radius: 0.5rem;
                    transition: var(--transition);
                }
                
                .user-menu:hover {
                    background: var(--light);
                }
                
                .user-avatar {
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: 600;
                }
                
                .user-info {
                    display: flex;
                    flex-direction: column;
                }
                
                .user-name {
                    font-weight: 600;
                    font-size: 0.95rem;
                }
                
                .user-role {
                    font-size: 0.8rem;
                    color: var(--gray);
                }
                
                /* Content */
                .content {
                    padding: 2rem;
                    min-height: calc(100vh - var(--header-height));
                }
                
                /* Stats Cards */
                .stats-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                    gap: 1.5rem;
                    margin-bottom: 2rem;
                }
                
                .stat-card {
                    background: white;
                    border-radius: 0.75rem;
                    padding: 1.5rem;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                    transition: var(--transition);
                    position: relative;
                    overflow: hidden;
                }
                
                .stat-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                }
                
                .stat-card::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 5px;
                    height: 100%;
                }
                
                .stat-card.primary::before {
                    background: var(--primary);
                }
                
                .stat-card.secondary::before {
                    background: var(--secondary);
                }
                
                .stat-card.warning::before {
                    background: var(--warning);
                }
                
                .stat-card.danger::before {
                    background: var(--danger);
                }
                
                .stat-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: flex-start;
                    margin-bottom: 1rem;
                }
                
                .stat-title {
                    font-size: 0.9rem;
                    color: var(--gray);
                    font-weight: 500;
                }
                
                .stat-icon {
                    font-size: 1.5rem;
                    color: var(--gray-light);
                }
                
                .stat-value {
                    font-size: 2rem;
                    font-weight: 700;
                    color: var(--dark);
                    margin-bottom: 0.5rem;
                }
                
                /* Tables */
                .table-container {
                    background: white;
                    border-radius: 0.75rem;
                    overflow: hidden;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                }
                
                .table-header {
                    padding: 1.5rem;
                    border-bottom: 1px solid var(--border);
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                
                .table-title {
                    font-size: 1.25rem;
                    font-weight: 600;
                }
                
                .table-actions {
                    display: flex;
                    gap: 0.75rem;
                }
                
                .table-content {
                    overflow-x: auto;
                }
                
                .data-table {
                    width: 100%;
                    border-collapse: collapse;
                }
                
                .data-table th {
                    background: var(--light);
                    padding: 1rem;
                    text-align: left;
                    font-weight: 600;
                    color: var(--dark);
                    border-bottom: 1px solid var(--border);
                    font-size: 0.9rem;
                    text-transform: uppercase;
                    letter-spacing: 0.05em;
                }
                
                .data-table td {
                    padding: 1rem;
                    border-bottom: 1px solid var(--border);
                    font-size: 0.95rem;
                }
                
                .data-table tr:hover {
                    background: var(--light);
                }
                
                .action-buttons {
                    display: flex;
                    gap: 0.5rem;
                }
                
                .btn {
                    padding: 0.5rem 1rem;
                    border-radius: 0.5rem;
                    border: none;
                    font-weight: 500;
                    cursor: pointer;
                    transition: var(--transition);
                    display: inline-flex;
                    align-items: center;
                    gap: 0.5rem;
                    font-size: 0.9rem;
                }
                
                .btn-sm {
                    padding: 0.25rem 0.75rem;
                    font-size: 0.85rem;
                }
                
                .btn-primary {
                    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
                    color: white;
                }
                
                .btn-secondary {
                    background: var(--secondary);
                    color: white;
                }
                
                .btn-outline {
                    background: white;
                    color: var(--dark);
                    border: 1px solid var(--border);
                }
                
                .btn-danger {
                    background: var(--danger);
                    color: white;
                }
                
                .btn:hover {
                    opacity: 0.9;
                }
                
                /* Forms */
                .form-group {
                    margin-bottom: 1.5rem;
                }
                
                .form-label {
                    display: block;
                    margin-bottom: 0.5rem;
                    font-weight: 500;
                }
                
                .form-control {
                    width: 100%;
                    padding: 0.75rem 1rem;
                    border: 1px solid var(--border);
                    border-radius: 0.5rem;
                    font-size: 1rem;
                }
                
                .form-control:focus {
                    outline: none;
                    border-color: var(--primary);
                    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                }
                
                .form-row {
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 1.5rem;
                }
                
                /* Loading */
                .loading-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(255,255,255,0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                }
                
                .loading-spinner {
                    width: 50px;
                    height: 50px;
                    border: 3px solid var(--gray-light);
                    border-top-color: var(--primary);
                    border-radius: 50%;
                    animation: spin 1s linear infinite;
                }
                
                /* Responsive */
                @media (max-width: 1200px) {
                    .sidebar {
                        transform: translateX(-100%);
                    }
                    .sidebar.active {
                        transform: translateX(0);
                    }
                    .main-content {
                        margin-left: 0;
                    }
                    .menu-toggle {
                        display: block;
                    }
                }
                
                @media (max-width: 768px) {
                    .header {
                        padding: 0 1rem;
                    }
                    .content {
                        padding: 1rem;
                    }
                    .form-row {
                        grid-template-columns: 1fr;
                    }
                    .stats-grid {
                        grid-template-columns: 1fr;
                    }
                }
            `;
            
            const styleSheet = document.createElement('style');
            styleSheet.textContent = styles;
            document.head.appendChild(styleSheet);
        }

        // Initialize app
        function initializeApp() {
            // Event listeners
            document.getElementById('menuToggle').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('active');
            });
            
            // Navigation
            document.querySelectorAll('.nav-link[data-page]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    navigateTo(page);
                    
                    // Close sidebar on mobile
                    if (window.innerWidth <= 1200) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                });
            });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', () => {
                if (confirm('Are you sure you want to logout?')) {
                    localStorage.removeItem('rawWealthyToken');
                    APP_STATE.token = null;
                    APP_STATE.user = null;
                    showLogin();
                    showToast('Logged out successfully', 'info');
                }
            });
            
            // Load initial page
            navigateTo('dashboard');
            
            // Start background updates
            startBackgroundUpdates();
        }

        // Navigation
        async function navigateTo(page) {
            APP_STATE.currentPage = page;
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`.nav-link[data-page="${page}"]`)?.classList.add('active');
            
            // Update page title
            const pageTitle = document.getElementById('pageTitle');
            const navText = document.querySelector(`.nav-link[data-page="${page}"] .nav-text`)?.textContent || page;
            pageTitle.textContent = navText;
            
            // Load page content
            await loadPageContent(page);
        }

        // Load page content
        async function loadPageContent(page) {
            const pageContent = document.getElementById('pageContent');
            
            switch(page) {
                case 'dashboard':
                    await loadDashboard(pageContent);
                    break;
                case 'users':
                    await loadUsers(pageContent);
                    break;
                case 'investments':
                    await loadInvestments(pageContent);
                    break;
                case 'deposits':
                    await loadDeposits(pageContent);
                    break;
                case 'withdrawals':
                    await loadWithdrawals(pageContent);
                    break;
                case 'transactions':
                    await loadTransactions(pageContent);
                    break;
                case 'kyc':
                    await loadKYC(pageContent);
                    break;
                case 'plans':
                    await loadPlans(pageContent);
                    break;
                case 'analytics':
                    await loadAnalytics(pageContent);
                    break;
                case 'settings':
                    await loadSettings(pageContent);
                    break;
                default:
                    pageContent.innerHTML = '<div class="table-container"><div class="table-header"><h2 class="table-title">Page Not Found</h2></div></div>';
            }
        }

        // Show loading
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // Hide loading
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // Start background updates
        function startBackgroundUpdates() {
            // Update badge counts every 30 seconds
            setInterval(updateBadgeCounts, 30000);
            
            // Initial badge update
            updateBadgeCounts();
        }

        // Update badge counts
        async function updateBadgeCounts() {
            try {
                const dashboard = await fetchData(API_CONFIG.endpoints.dashboard);
                if (dashboard?.stats?.pending_actions) {
                    const pending = dashboard.stats.pending_actions;
                    updateBadge('depositCount', pending.pending_deposits || 0);
                    updateBadge('withdrawalCount', pending.pending_withdrawals || 0);
                    updateBadge('kycCount', pending.pending_kyc || 0);
                    updateBadge('investmentCount', pending.pending_investments || 0);
                }
                
                const users = await fetchData(API_CONFIG.endpoints.users + '?limit=1');
                if (users?.pagination?.total) {
                    updateBadge('userCount', users.pagination.total);
                }
            } catch (error) {
                console.error('Failed to update badge counts:', error);
            }
        }

        // Update badge
        function updateBadge(id, count) {
            const badge = document.getElementById(id);
            if (badge) {
                badge.textContent = count;
                badge.style.display = count > 0 ? 'inline-flex' : 'none';
            }
        }

        // Fetch data with cache
        async function fetchData(endpoint, forceRefresh = false) {
            const cacheKey = endpoint;
            const now = Date.now();
            const cacheTime = 30000; // 30 seconds cache
            
            // Check cache
            if (!forceRefresh && APP_STATE.dataCache.has(cacheKey)) {
                const cached = APP_STATE.dataCache.get(cacheKey);
                if (now - cached.timestamp < cacheTime) {
                    return cached.data;
                }
            }
            
            try {
                showLoading();
                const response = await apiFetch(endpoint);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                // Cache the data
                if (data.success) {
                    APP_STATE.dataCache.set(cacheKey, {
                        data: data.data,
                        timestamp: now
                    });
                    APP_STATE.lastFetch.set(cacheKey, now);
                }
                
                return data.data;
            } catch (error) {
                console.error('Fetch error:', error);
                showToast(`Failed to load data: ${error.message}`, 'error');
                throw error;
            } finally {
                hideLoading();
            }
        }

        // Load dashboard
        async function loadDashboard(container) {
            try {
                const data = await fetchData(API_CONFIG.endpoints.dashboard);
                
                container.innerHTML = `
                    <div class="stats-grid">
                        <div class="stat-card primary">
                            <div class="stat-header">
                                <div class="stat-title">Total Users</div>
                                <div class="stat-icon"><i class="fas fa-users"></i></div>
                            </div>
                            <div class="stat-value">${data?.stats?.overview?.total_users?.toLocaleString() || '0'}</div>
                            <div class="stat-change">${data?.stats?.overview?.new_users_today || '0'} new today</div>
                        </div>
                        
                        <div class="stat-card secondary">
                            <div class="stat-header">
                                <div class="stat-title">Active Investments</div>
                                <div class="stat-icon"><i class="fas fa-chart-pie"></i></div>
                            </div>
                            <div class="stat-value">${data?.stats?.overview?.active_investments?.toLocaleString() || '0'}</div>
                            <div class="stat-change">₦${data?.stats?.overview?.total_investments?.toLocaleString() || '0'} total</div>
                        </div>
                        
                        <div class="stat-card warning">
                            <div class="stat-header">
                                <div class="stat-title">Pending Actions</div>
                                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                            </div>
                            <div class="stat-value">${data?.stats?.pending_actions?.total_pending?.toLocaleString() || '0'}</div>
                            <div class="stat-change">Requires attention</div>
                        </div>
                        
                        <div class="stat-card danger">
                            <div class="stat-header">
                                <div class="stat-title">Platform Revenue</div>
                                <div class="stat-icon"><i class="fas fa-money-bill-wave"></i></div>
                            </div>
                            <div class="stat-value">₦${data?.stats?.overview?.total_earnings?.toLocaleString() || '0'}</div>
                            <div class="stat-change">From all activities</div>
                        </div>
                    </div>
                    
                    <div class="table-container" style="margin-top: 2rem;">
                        <div class="table-header">
                            <h2 class="table-title">Quick Actions</h2>
                            <div class="table-actions">
                                <button class="btn btn-outline" onclick="refreshDashboard()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="table-content">
                            <div style="padding: 2rem; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
                                ${data?.stats?.pending_actions?.pending_deposits > 0 ? `
                                <div class="action-card" onclick="navigateTo('deposits')" style="cursor: pointer; padding: 1.5rem; background: white; border-radius: 0.75rem; border-left: 4px solid var(--primary);">
                                    <div style="display: flex; align-items: center; gap: 1rem;">
                                        <div style="background: rgba(102, 126, 234, 0.1); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-money-bill-wave" style="color: var(--primary); font-size: 1.5rem;"></i>
                                        </div>
                                        <div>
                                            <h3 style="margin: 0 0 0.5rem 0;">Pending Deposits</h3>
                                            <p style="margin: 0; color: var(--gray);">${data.stats.pending_actions.pending_deposits} deposits awaiting approval</p>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${data?.stats?.pending_actions?.pending_withdrawals > 0 ? `
                                <div class="action-card" onclick="navigateTo('withdrawals')" style="cursor: pointer; padding: 1.5rem; background: white; border-radius: 0.75rem; border-left: 4px solid var(--warning);">
                                    <div style="display: flex; align-items: center; gap: 1rem;">
                                        <div style="background: rgba(245, 158, 11, 0.1); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-wallet" style="color: var(--warning); font-size: 1.5rem;"></i>
                                        </div>
                                        <div>
                                            <h3 style="margin: 0 0 0.5rem 0;">Pending Withdrawals</h3>
                                            <p style="margin: 0; color: var(--gray);">${data.stats.pending_actions.pending_withdrawals} withdrawals to process</p>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${data?.stats?.pending_actions?.pending_investments > 0 ? `
                                <div class="action-card" onclick="navigateTo('investments')" style="cursor: pointer; padding: 1.5rem; background: white; border-radius: 0.75rem; border-left: 4px solid var(--secondary);">
                                    <div style="display: flex; align-items: center; gap: 1rem;">
                                        <div style="background: rgba(16, 185, 129, 0.1); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-chart-pie" style="color: var(--secondary); font-size: 1.5rem;"></i>
                                        </div>
                                        <div>
                                            <h3 style="margin: 0 0 0.5rem 0;">Pending Investments</h3>
                                            <p style="margin: 0; color: var(--gray);">${data.stats.pending_actions.pending_investments} investments to approve</p>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${data?.stats?.pending_actions?.pending_kyc > 0 ? `
                                <div class="action-card" onclick="navigateTo('kyc')" style="cursor: pointer; padding: 1.5rem; background: white; border-radius: 0.75rem; border-left: 4px solid var(--info);">
                                    <div style="display: flex; align-items: center; gap: 1rem;">
                                        <div style="background: rgba(59, 130, 246, 0.1); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-id-card" style="color: var(--info); font-size: 1.5rem;"></i>
                                        </div>
                                        <div>
                                            <h3 style="margin: 0 0 0.5rem 0;">Pending KYC</h3>
                                            <p style="margin: 0; color: var(--gray);">${data.stats.pending_actions.pending_kyc} verifications pending</p>
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Error Loading Dashboard</h2>
                        </div>
                        <div style="padding: 3rem; text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--warning); margin-bottom: 1rem;"></i>
                            <p>Failed to load dashboard data. Please try again.</p>
                            <button class="btn btn-primary" onclick="loadDashboard(document.getElementById('pageContent'))">
                                <i class="fas fa-sync-alt"></i> Retry
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Load users
        async function loadUsers(container) {
            try {
                const data = await fetchData(API_CONFIG.endpoints.users + '?limit=20&page=1');
                
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Users Management</h2>
                            <div class="table-actions">
                                <button class="btn btn-outline" onclick="refreshUsers()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                                <button class="btn btn-primary" onclick="showCreateUserModal()">
                                    <i class="fas fa-plus"></i> Add User
                                </button>
                            </div>
                        </div>
                        <div class="table-content">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Balance</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>KYC</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    ${data?.users?.map(user => `
                                        <tr>
                                            <td>
                                                <strong>${user.full_name}</strong><br>
                                                <small style="color: var(--gray);">${user.phone || 'N/A'}</small>
                                            </td>
                                            <td>${user.email}</td>
                                            <td>₦${user.balance?.toLocaleString() || '0'}</td>
                                            <td>
                                                <span class="status-badge ${user.role === 'super_admin' ? 'status-active' : user.role === 'admin' ? 'status-approved' : 'status-pending'}">
                                                    ${user.role?.replace('_', ' ').toUpperCase()}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="status-badge ${user.is_active ? 'status-active' : 'status-rejected'}">
                                                    ${user.is_active ? 'Active' : 'Inactive'}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="status-badge ${user.kyc_status === 'verified' ? 'status-approved' : user.kyc_status === 'pending' ? 'status-pending' : 'status-rejected'}">
                                                    ${user.kyc_status?.toUpperCase() || 'NOT SUBMITTED'}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="btn btn-sm btn-outline" onclick="viewUser('${user._id}')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-outline" onclick="editUser('${user._id}')">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm ${user.is_active ? 'btn-danger' : 'btn-secondary'}" onclick="toggleUserStatus('${user._id}', ${user.is_active})">
                                                        <i class="fas fa-power-off"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('') || '<tr><td colspan="7" style="text-align: center; padding: 2rem;">No users found</td></tr>'}
                                </tbody>
                            </table>
                            ${data?.pagination?.pages > 1 ? `
                            <div style="padding: 1.5rem; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    Showing ${data.pagination.page} of ${data.pagination.pages} pages
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    ${data.pagination.page > 1 ? `
                                    <button class="btn btn-outline" onclick="loadUsersPage(${data.pagination.page - 1})">
                                        <i class="fas fa-chevron-left"></i> Previous
                                    </button>
                                    ` : ''}
                                    ${data.pagination.page < data.pagination.pages ? `
                                    <button class="btn btn-outline" onclick="loadUsersPage(${data.pagination.page + 1})">
                                        Next <i class="fas fa-chevron-right"></i>
                                    </button>
                                    ` : ''}
                                </div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Error Loading Users</h2>
                        </div>
                        <div style="padding: 3rem; text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--warning); margin-bottom: 1rem;"></i>
                            <p>Failed to load users. Please try again.</p>
                            <button class="btn btn-primary" onclick="loadUsers(document.getElementById('pageContent'))">
                                <i class="fas fa-sync-alt"></i> Retry
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Load investments
        async function loadInvestments(container) {
            try {
                const data = await fetchData(API_CONFIG.endpoints.pendingInvestments);
                
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Pending Investments</h2>
                            <div class="table-actions">
                                <button class="btn btn-outline" onclick="refreshInvestments()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="table-content">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Plan</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="investmentsTableBody">
                                    ${data?.investments?.map(inv => `
                                        <tr>
                                            <td>
                                                <strong>${inv.user?.full_name || 'N/A'}</strong><br>
                                                <small style="color: var(--gray);">${inv.user?.email || 'N/A'}</small>
                                            </td>
                                            <td>${inv.plan?.name || 'N/A'}</td>
                                            <td>₦${inv.amount?.toLocaleString() || '0'}</td>
                                            <td>
                                                <span class="status-badge status-pending">
                                                    ${inv.status?.toUpperCase() || 'PENDING'}
                                                </span>
                                            </td>
                                            <td>${new Date(inv.createdAt).toLocaleDateString()}</td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="btn btn-sm btn-primary" onclick="approveInvestment('${inv._id}')">
                                                        <i class="fas fa-check"></i> Approve
                                                    </button>
                                                    <button class="btn btn-sm btn-outline" onclick="viewInvestment('${inv._id}')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('') || '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No pending investments</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Error Loading Investments</h2>
                        </div>
                        <div style="padding: 3rem; text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--warning); margin-bottom: 1rem;"></i>
                            <p>Failed to load investments. Please try again.</p>
                            <button class="btn btn-primary" onclick="loadInvestments(document.getElementById('pageContent'))">
                                <i class="fas fa-sync-alt"></i> Retry
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Load deposits
        async function loadDeposits(container) {
            try {
                const data = await fetchData(API_CONFIG.endpoints.pendingDeposits);
                
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Pending Deposits</h2>
                            <div class="table-actions">
                                <button class="btn btn-outline" onclick="refreshDeposits()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="table-content">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Method</th>
                                        <th>Reference</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="depositsTableBody">
                                    ${data?.deposits?.map(dep => `
                                        <tr>
                                            <td>
                                                <strong>${dep.user?.full_name || 'N/A'}</strong><br>
                                                <small style="color: var(--gray);">${dep.user?.email || 'N/A'}</small>
                                            </td>
                                            <td>₦${dep.amount?.toLocaleString() || '0'}</td>
                                            <td>${dep.payment_method?.replace('_', ' ').toUpperCase() || 'N/A'}</td>
                                            <td><small>${dep.reference || 'N/A'}</small></td>
                                            <td>${new Date(dep.createdAt).toLocaleDateString()}</td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="btn btn-sm btn-primary" onclick="approveDeposit('${dep._id}')">
                                                        <i class="fas fa-check"></i> Approve
                                                    </button>
                                                    <button class="btn btn-sm btn-outline" onclick="viewDeposit('${dep._id}')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('') || '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No pending deposits</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Error Loading Deposits</h2>
                        </div>
                        <div style="padding: 3rem; text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--warning); margin-bottom: 1rem;"></i>
                            <p>Failed to load deposits. Please try again.</p>
                            <button class="btn btn-primary" onclick="loadDeposits(document.getElementById('pageContent'))">
                                <i class="fas fa-sync-alt"></i> Retry
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Load withdrawals
        async function loadWithdrawals(container) {
            try {
                const data = await fetchData(API_CONFIG.endpoints.pendingWithdrawals);
                
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Pending Withdrawals</h2>
                            <div class="table-actions">
                                <button class="btn btn-outline" onclick="refreshWithdrawals()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="table-content">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Amount</th>
                                        <th>Net Amount</th>
                                        <th>Method</th>
                                        <th>Reference</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="withdrawalsTableBody">
                                    ${data?.withdrawals?.map(wd => `
                                        <tr>
                                            <td>
                                                <strong>${wd.user?.full_name || 'N/A'}</strong><br>
                                                <small style="color: var(--gray);">${wd.user?.email || 'N/A'}</small>
                                            </td>
                                            <td>₦${wd.amount?.toLocaleString() || '0'}</td>
                                            <td>₦${wd.net_amount?.toLocaleString() || '0'}</td>
                                            <td>${wd.payment_method?.replace('_', ' ').toUpperCase() || 'N/A'}</td>
                                            <td><small>${wd.reference || 'N/A'}</small></td>
                                            <td>${new Date(wd.createdAt).toLocaleDateString()}</td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="btn btn-sm btn-primary" onclick="approveWithdrawal('${wd._id}')">
                                                        <i class="fas fa-check"></i> Approve
                                                    </button>
                                                    <button class="btn btn-sm btn-outline" onclick="viewWithdrawal('${wd._id}')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('') || '<tr><td colspan="7" style="text-align: center; padding: 2rem;">No pending withdrawals</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Error Loading Withdrawals</h2>
                        </div>
                        <div style="padding: 3rem; text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--warning); margin-bottom: 1rem;"></i>
                            <p>Failed to load withdrawals. Please try again.</p>
                            <button class="btn btn-primary" onclick="loadWithdrawals(document.getElementById('pageContent'))">
                                <i class="fas fa-sync-alt"></i> Retry
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Load transactions
        async function loadTransactions(container) {
            try {
                const data = await fetchData(API_CONFIG.endpoints.transactions + '?limit=20&page=1');
                
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">All Transactions</h2>
                            <div class="table-actions">
                                <button class="btn btn-outline" onclick="refreshTransactions()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="table-content">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Description</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsTableBody">
                                    ${data?.transactions?.map(tx => `
                                        <tr>
                                            <td>
                                                <strong>${tx.user?.full_name || 'N/A'}</strong><br>
                                                <small style="color: var(--gray);">${tx.user?.email || 'N/A'}</small>
                                            </td>
                                            <td>
                                                <span class="status-badge ${tx.type === 'deposit' || tx.type === 'earning' ? 'status-approved' : tx.type === 'withdrawal' ? 'status-pending' : 'status-active'}">
                                                    ${tx.type?.toUpperCase() || 'N/A'}
                                                </span>
                                            </td>
                                            <td style="color: ${tx.amount >= 0 ? 'var(--secondary)' : 'var(--danger)'}; font-weight: 600;">
                                                ${tx.amount >= 0 ? '+' : ''}₦${Math.abs(tx.amount || 0).toLocaleString()}
                                            </td>
                                            <td>${tx.description || 'N/A'}</td>
                                            <td>
                                                <span class="status-badge ${tx.status === 'completed' ? 'status-approved' : tx.status === 'pending' ? 'status-pending' : 'status-rejected'}">
                                                    ${tx.status?.toUpperCase() || 'N/A'}
                                                </span>
                                            </td>
                                            <td>${new Date(tx.createdAt).toLocaleString()}</td>
                                        </tr>
                                    `).join('') || '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No transactions found</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Error Loading Transactions</h2>
                        </div>
                        <div style="padding: 3rem; text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--warning); margin-bottom: 1rem;"></i>
                            <p>Failed to load transactions. Please try again.</p>
                            <button class="btn btn-primary" onclick="loadTransactions(document.getElementById('pageContent'))">
                                <i class="fas fa-sync-alt"></i> Retry
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Load KYC
        async function loadKYC(container) {
            try {
                const data = await fetchData(API_CONFIG.endpoints.pendingKYC);
                
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">KYC Verifications</h2>
                            <div class="table-actions">
                                <button class="btn btn-outline" onclick="refreshKYC()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="table-content">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>ID Type</th>
                                        <th>ID Number</th>
                                        <th>Status</th>
                                        <th>Submitted</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="kycTableBody">
                                    ${data?.kyc_submissions?.map(kyc => `
                                        <tr>
                                            <td>
                                                <strong>${kyc.user?.full_name || 'N/A'}</strong><br>
                                                <small style="color: var(--gray);">${kyc.user?.email || 'N/A'}</small>
                                            </td>
                                            <td>${kyc.id_type?.replace('_', ' ').toUpperCase() || 'N/A'}</td>
                                            <td>${kyc.id_number || 'N/A'}</td>
                                            <td>
                                                <span class="status-badge status-pending">
                                                    ${kyc.status?.toUpperCase() || 'PENDING'}
                                                </span>
                                            </td>
                                            <td>${new Date(kyc.createdAt).toLocaleDateString()}</td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="btn btn-sm btn-primary" onclick="approveKYC('${kyc._id}')">
                                                        <i class="fas fa-check"></i> Approve
                                                    </button>
                                                    <button class="btn btn-sm btn-outline" onclick="viewKYC('${kyc._id}')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('') || '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No pending KYC submissions</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Error Loading KYC</h2>
                        </div>
                        <div style="padding: 3rem; text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--warning); margin-bottom: 1rem;"></i>
                            <p>Failed to load KYC submissions. Please try again.</p>
                            <button class="btn btn-primary" onclick="loadKYC(document.getElementById('pageContent'))">
                                <i class="fas fa-sync-alt"></i> Retry
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Load plans
        async function loadPlans(container) {
            try {
                const data = await fetchData(API_CONFIG.endpoints.plans);
                
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Investment Plans</h2>
                            <div class="table-actions">
                                <button class="btn btn-outline" onclick="refreshPlans()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="table-content">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Min Amount</th>
                                        <th>Daily Interest</th>
                                        <th>Duration</th>
                                        <th>Risk Level</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="plansTableBody">
                                    ${data?.plans?.map(plan => `
                                        <tr>
                                            <td>
                                                <strong>${plan.name}</strong><br>
                                                <small style="color: var(--gray);">${plan.category?.replace('_', ' ').toUpperCase()}</small>
                                            </td>
                                            <td>₦${plan.min_amount?.toLocaleString() || '0'}</td>
                                            <td>${plan.daily_interest}%</td>
                                            <td>${plan.duration} days</td>
                                            <td>
                                                <span class="status-badge ${plan.risk_level === 'low' ? 'status-approved' : plan.risk_level === 'medium' ? 'status-active' : 'status-rejected'}">
                                                    ${plan.risk_level?.toUpperCase()}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="status-badge ${plan.is_active ? 'status-active' : 'status-rejected'}">
                                                    ${plan.is_active ? 'ACTIVE' : 'INACTIVE'}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="btn btn-sm btn-outline" onclick="viewPlan('${plan._id}')">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('') || '<tr><td colspan="7" style="text-align: center; padding: 2rem;">No plans found</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            } catch (error) {
                container.innerHTML = `
                    <div class="table-container">
                        <div class="table-header">
                            <h2 class="table-title">Error Loading Plans</h2>
                        </div>
                        <div style="padding: 3rem; text-align: center;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--warning); margin-bottom: 1rem;"></i>
                            <p>Failed to load plans. Please try again.</p>
                            <button class="btn btn-primary" onclick="loadPlans(document.getElementById('pageContent'))">
                                <i class="fas fa-sync-alt"></i> Retry
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Load analytics
        async function loadAnalytics(container) {
            container.innerHTML = `
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Analytics Dashboard</h2>
                        <div class="table-actions">
                            <select class="form-control" id="analyticsPeriod" style="width: auto;">
                                <option value="week">Last 7 Days</option>
                                <option value="month" selected>Last 30 Days</option>
                                <option value="quarter">Last 90 Days</option>
                                <option value="year">Last 365 Days</option>
                            </select>
                        </div>
                    </div>
                    <div style="padding: 2rem; text-align: center;">
                        <i class="fas fa-chart-line" style="font-size: 4rem; color: var(--gray-light); margin-bottom: 1rem;"></i>
                        <h3>Advanced Analytics Coming Soon</h3>
                        <p>Detailed analytics and charts will be available in the next update.</p>
                    </div>
                </div>
            `;
        }

        // Load settings
        async function loadSettings(container) {
            container.innerHTML = `
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">System Settings</h2>
                    </div>
                    <div style="padding: 2rem;">
                        <div style="max-width: 600px; margin: 0 auto;">
                            <div class="form-group">
                                <label class="form-label">Backend URL</label>
                                <input type="text" class="form-control" value="${BACKEND_URL}" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Admin User</label>
                                <input type="text" class="form-control" value="${APP_STATE.user?.email || 'N/A'}" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">User Role</label>
                                <input type="text" class="form-control" value="${APP_STATE.user?.role?.toUpperCase() || 'ADMIN'}" readonly>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary" onclick="clearCache()">
                                    <i class="fas fa-broom"></i> Clear Cache
                                </button>
                                <button class="btn btn-outline" onclick="refreshAllData()" style="margin-left: 10px;">
                                    <i class="fas fa-sync-alt"></i> Refresh All Data
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Action Functions
        window.refreshDashboard = async () => {
            await fetchData(API_CONFIG.endpoints.dashboard, true);
            await loadDashboard(document.getElementById('pageContent'));
            showToast('Dashboard refreshed', 'success');
        };

        window.refreshUsers = async () => {
            await fetchData(API_CONFIG.endpoints.users, true);
            await loadUsers(document.getElementById('pageContent'));
            showToast('Users refreshed', 'success');
        };

        window.refreshInvestments = async () => {
            await fetchData(API_CONFIG.endpoints.pendingInvestments, true);
            await loadInvestments(document.getElementById('pageContent'));
            showToast('Investments refreshed', 'success');
        };

        window.refreshDeposits = async () => {
            await fetchData(API_CONFIG.endpoints.pendingDeposits, true);
            await loadDeposits(document.getElementById('pageContent'));
            showToast('Deposits refreshed', 'success');
        };

        window.refreshWithdrawals = async () => {
            await fetchData(API_CONFIG.endpoints.pendingWithdrawals, true);
            await loadWithdrawals(document.getElementById('pageContent'));
            showToast('Withdrawals refreshed', 'success');
        };

        window.refreshTransactions = async () => {
            await fetchData(API_CONFIG.endpoints.transactions, true);
            await loadTransactions(document.getElementById('pageContent'));
            showToast('Transactions refreshed', 'success');
        };

        window.refreshKYC = async () => {
            await fetchData(API_CONFIG.endpoints.pendingKYC, true);
            await loadKYC(document.getElementById('pageContent'));
            showToast('KYC refreshed', 'success');
        };

        window.refreshPlans = async () => {
            await fetchData(API_CONFIG.endpoints.plans, true);
            await loadPlans(document.getElementById('pageContent'));
            showToast('Plans refreshed', 'success');
        };

        window.refreshAllData = () => {
            APP_STATE.dataCache.clear();
            navigateTo(APP_STATE.currentPage);
            showToast('All data refreshed', 'success');
        };

        window.clearCache = () => {
            APP_STATE.dataCache.clear();
            showToast('Cache cleared', 'success');
        };

        window.navigateTo = (page) => navigateTo(page);

        // User Actions
        window.viewUser = (userId) => {
            alert(`View user ${userId} - Detailed view coming soon`);
        };

        window.editUser = (userId) => {
            alert(`Edit user ${userId} - Edit functionality coming soon`);
        };

        window.toggleUserStatus = async (userId, isActive) => {
            if (confirm(`Are you sure you want to ${isActive ? 'deactivate' : 'activate'} this user?`)) {
                try {
                    const response = await apiFetch(API_CONFIG.endpoints.userStatus.replace('{id}', userId), {
                        method: 'PUT',
                        body: JSON.stringify({ is_active: !isActive })
                    });
                    
                    if (response.ok) {
                        showToast(`User ${isActive ? 'deactivated' : 'activated'} successfully`, 'success');
                        await refreshUsers();
                        await updateBadgeCounts();
                    } else {
                        throw new Error('Failed to update user status');
                    }
                } catch (error) {
                    showToast(`Failed to update user status: ${error.message}`, 'error');
                }
            }
        };

        // Investment Actions
        window.approveInvestment = async (investmentId) => {
            if (confirm('Approve this investment?')) {
                try {
                    const response = await apiFetch(API_CONFIG.endpoints.approveInvestment.replace('{id}', investmentId), {
                        method: 'POST',
                        body: JSON.stringify({ remarks: 'Approved via admin dashboard' })
                    });
                    
                    if (response.ok) {
                        showToast('Investment approved successfully', 'success');
                        await refreshInvestments();
                        await updateBadgeCounts();
                    } else {
                        throw new Error('Failed to approve investment');
                    }
                } catch (error) {
                    showToast(`Failed to approve investment: ${error.message}`, 'error');
                }
            }
        };

        window.viewInvestment = (investmentId) => {
            alert(`View investment ${investmentId} - Detailed view coming soon`);
        };

        // Deposit Actions
        window.approveDeposit = async (depositId) => {
            if (confirm('Approve this deposit?')) {
                try {
                    const response = await apiFetch(API_CONFIG.endpoints.approveDeposit.replace('{id}', depositId), {
                        method: 'POST',
                        body: JSON.stringify({ remarks: 'Approved via admin dashboard' })
                    });
                    
                    if (response.ok) {
                        showToast('Deposit approved successfully', 'success');
                        await refreshDeposits();
                        await updateBadgeCounts();
                    } else {
                        throw new Error('Failed to approve deposit');
                    }
                } catch (error) {
                    showToast(`Failed to approve deposit: ${error.message}`, 'error');
                }
            }
        };

        window.viewDeposit = (depositId) => {
            alert(`View deposit ${depositId} - Detailed view coming soon`);
        };

        // Withdrawal Actions
        window.approveWithdrawal = async (withdrawalId) => {
            if (confirm('Approve this withdrawal?')) {
                try {
                    const response = await apiFetch(API_CONFIG.endpoints.approveWithdrawal.replace('{id}', withdrawalId), {
                        method: 'POST',
                        body: JSON.stringify({ 
                            transaction_id: `TRX${Date.now()}`,
                            remarks: 'Approved via admin dashboard' 
                        })
                    });
                    
                    if (response.ok) {
                        showToast('Withdrawal approved successfully', 'success');
                        await refreshWithdrawals();
                        await updateBadgeCounts();
                    } else {
                        throw new Error('Failed to approve withdrawal');
                    }
                } catch (error) {
                    showToast(`Failed to approve withdrawal: ${error.message}`, 'error');
                }
            }
        };

        window.viewWithdrawal = (withdrawalId) => {
            alert(`View withdrawal ${withdrawalId} - Detailed view coming soon`);
        };

        // KYC Actions
        window.approveKYC = async (kycId) => {
            if (confirm('Approve this KYC submission?')) {
                try {
                    const response = await apiFetch(API_CONFIG.endpoints.approveKYC.replace('{id}', kycId), {
                        method: 'POST',
                        body: JSON.stringify({ remarks: 'Verified via admin dashboard' })
                    });
                    
                    if (response.ok) {
                        showToast('KYC approved successfully', 'success');
                        await refreshKYC();
                        await updateBadgeCounts();
                    } else {
                        throw new Error('Failed to approve KYC');
                    }
                } catch (error) {
                    showToast(`Failed to approve KYC: ${error.message}`, 'error');
                }
            }
        };

        window.viewKYC = (kycId) => {
            alert(`View KYC ${kycId} - Detailed view coming soon`);
        };

        // Plan Actions
        window.viewPlan = (planId) => {
            alert(`View plan ${planId} - Detailed view coming soon`);
        };

        // Show create user modal
        window.showCreateUserModal = () => {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 10px; padding: 30px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto;">
                    <h2 style="margin: 0 0 20px 0;">Create New User</h2>
                    <form id="createUserForm">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="newUserName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="newUserEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone</label>
                            <input type="text" class="form-control" id="newUserPhone" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="newUserPassword" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Role</label>
                            <select class="form-control" id="newUserRole">
                                <option value="user">User</option>
                                <option value="admin">Admin</option>
                                <option value="super_admin">Super Admin</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 30px;">
                            <button type="button" class="btn btn-outline" onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="flex: 1;">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary" style="flex: 1;">
                                Create User
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.querySelector('#createUserForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const userData = {
                    full_name: document.getElementById('newUserName').value,
                    email: document.getElementById('newUserEmail').value,
                    phone: document.getElementById('newUserPhone').value,
                    password: document.getElementById('newUserPassword').value,
                    role: document.getElementById('newUserRole').value
                };
                
                try {
                    const response = await apiFetch(API_CONFIG.endpoints.createUser, {
                        method: 'POST',
                        body: JSON.stringify(userData)
                    });
                    
                    if (response.ok) {
                        showToast('User created successfully', 'success');
                        modal.remove();
                        await refreshUsers();
                    } else {
                        throw new Error('Failed to create user');
                    }
                } catch (error) {
                    showToast(`Failed to create user: ${error.message}`, 'error');
                }
            });
        };

        // Load users page
        window.loadUsersPage = async (page) => {
            try {
                const data = await fetchData(`${API_CONFIG.endpoints.users}?limit=20&page=${page}`);
                
                const tbody = document.getElementById('usersTableBody');
                if (tbody) {
                    tbody.innerHTML = data?.users?.map(user => `
                        <tr>
                            <td>
                                <strong>${user.full_name}</strong><br>
                                <small style="color: var(--gray);">${user.phone || 'N/A'}</small>
                            </td>
                            <td>${user.email}</td>
                            <td>₦${user.balance?.toLocaleString() || '0'}</td>
                            <td>
                                <span class="status-badge ${user.role === 'super_admin' ? 'status-active' : user.role === 'admin' ? 'status-approved' : 'status-pending'}">
                                    ${user.role?.replace('_', ' ').toUpperCase()}
                                </span>
                            </td>
                            <td>
                                <span class="status-badge ${user.is_active ? 'status-active' : 'status-rejected'}">
                                    ${user.is_active ? 'Active' : 'Inactive'}
                                </span>
                            </td>
                            <td>
                                <span class="status-badge ${user.kyc_status === 'verified' ? 'status-approved' : user.kyc_status === 'pending' ? 'status-pending' : 'status-rejected'}">
                                    ${user.kyc_status?.toUpperCase() || 'NOT SUBMITTED'}
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-sm btn-outline" onclick="viewUser('${user._id}')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline" onclick="editUser('${user._id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm ${user.is_active ? 'btn-danger' : 'btn-secondary'}" onclick="toggleUserStatus('${user._id}', ${user.is_active})">
                                        <i class="fas fa-power-off"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `).join('') || '<tr><td colspan="7" style="text-align: center; padding: 2rem;">No users found</td></tr>';
                }
            } catch (error) {
                showToast('Failed to load page', 'error');
            }
        };

        // Check backend health
        async function checkBackendHealth() {
            try {
                const response = await fetch(`${BACKEND_URL}/health`);
                if (response.ok) {
                    console.log('Backend is healthy');
                } else {
                    console.warn('Backend health check failed');
                }
            } catch (error) {
                console.error('Backend is unreachable:', error);
            }
        }

        // Initial health check
        checkBackendHealth();
    </script>
</body>
</html>
